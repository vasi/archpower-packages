# Maintainer: Morten Linderud <foxboron@archlinux.org>
# Maintainer: Maxim Baz <archlinux at maximbaz dot com>
# Contributor: Frank Lenormand <lenormf at gmail dot com>
pkgname=kakoune
pkgver=2025.06.03
pkgrel=3
pkgdesc="Multiple-selection, UNIX-flavored modal editor"
arch=("x86_64" 'powerpc')
url="https://kakoune.org/"
license=("custom:unlicense")
depends=("gcc-libs")
makedepends=("git")
optdepends=(
    "aspell: spell check, correct text"
    "clang: error reporting and diagnostics, completion"
    "editorconfig-core-c: set formatting options project-wide"
    "git: display and cycle through hunks, blame lines, handle file status"
    "kakoune-lsp: Language Server Protocol (LSP) client"
    "tmux: split windows, spawn tabs"
    "xdotool: X11 window management"
    "xorg-xmessage: print detailed crash information in a separate window"
)
source=("https://github.com/mawww/kakoune/releases/download/v${pkgver}/kakoune-${pkgver}.tar.bz2"
        "custom-libexecdir.patch")
b2sums=('de2d985e423660ed4e78be6b7dc93b15ff1fdb2b13133faa6145af0656f8ea425f7bbe82f0047ad8f1e1c9a8caf50a5e430cee717c9d10c13d5f3213419d18c3'
        '2c97785427851a01503bb99e2d0b725e4c11a42411669454f8bdfece00196d63c8dcd84e978840a2a83deed594b0c198e76d964fe8adcf21b6fe4eedb9c987e2')

prepare() {
    git -C ${pkgname}-${pkgver} apply ../custom-libexecdir.patch
}

build() {
    cd "${pkgname}-${pkgver}"
    make
}

check() {
    cd "${pkgname}-${pkgver}"
    make test
}

package() {
    cd "${pkgname}-${pkgver}"
    make install-strip DESTDIR="${pkgdir}" PREFIX=/usr libexecdir="${pkgdir}/usr/lib/kak"
    install -D UNLICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}

